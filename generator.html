<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI生成器 - Lingo 智能文创平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#E6A42A',
                        secondary: '#A66C3F',
                        accent: '#D85B32',
                        light: '#FFF9F0',
                        dark: '#333333',
                        muted: '#8A8A8A'
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                        serif: ['Noto Serif SC', 'serif']
                    },
                    boxShadow: {
                        'soft': '0 10px 25px -5px rgba(230, 164, 42, 0.1), 0 10px 10px -5px rgba(230, 164, 42, 0.04)',
                        'hover': '0 20px 25px -5px rgba(230, 164, 42, 0.2), 0 10px 10px -5px rgba(230, 164, 42, 0.1)'
                    },
                    backgroundImage: {
                        'hero-pattern': "url('https://picsum.photos/1200/600')",
                        'overlay': 'linear-gradient(to right, rgba(255, 249, 240, 0.95), rgba(255, 249, 240, 0.8))'
                    }
                },
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            }
            .text-shadow-sm {
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            }
            .animate-float {
                animation: float 6s ease-in-out infinite;
            }
            .animate-float-delay-1 {
                animation: float 6s ease-in-out 1s infinite;
            }
            .animate-float-delay-2 {
                animation: float 6s ease-in-out 2s infinite;
            }
            .transition-custom {
                transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .blur-backdrop {
                backdrop-filter: blur(8px);
            }
        }
        
        @keyframes float {
            0% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-20px);
            }
            100% {
                transform: translateY(0px);
            }
        }
    </style>
</head>
<body class="bg-light font-sans text-dark antialiased">
    <!-- 导航栏 -->
    <header id="navbar" class="fixed top-0 left-0 w-full z-50 transition-all duration-300">
        <div class="container mx-auto px-4 md:px-6">
            <nav class="flex items-center justify-between py-4 md:py-5">
                <div class="flex items-center">
                    <a href="index.html">
                        <img src="logo.jpg" alt="Lingo Logo" class="h-18 md:h-20">
                    </a>
                </div>
                
                <!-- 桌面导航 -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="text-dark hover:text-primary font-medium transition-custom">首页</a>
                    <a href="works.html" class="text-dark hover:text-primary font-medium transition-custom">我的作品</a>
                    <a href="generator.html" class="text-primary font-medium transition-custom">AI生成器</a>
                    <a href="community.html" class="text-dark hover:text-primary font-medium transition-custom">社区</a>
                    <a href="profile.html" class="text-dark hover:text-primary font-medium transition-custom">个人中心</a>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- 用户状态显示区域 -->
                    <div id="user-status" class="hidden md:flex items-center space-x-6">
                        <!-- 登录用户信息 -->
                        <div id="logged-in-user" class="hidden items-center space-x-4 flex items-center">
                            <div class="flex items-center space-x-3">
                                <img id="user-avatar" src="" alt="用户头像" class="w-10 h-10 rounded-full border-2 border-primary">
                                <span id="user-name" class="text-dark font-medium text-base"></span>
                            </div>
                            <button id="logout-btn" class="px-4 py-2 text-sm text-muted hover:text-primary hover:bg-gray-100 rounded-lg transition-custom">退出</button>
                        </div>
                        <!-- 未登录状态 -->
                        <div id="guest-user" class="flex items-center space-x-4">
                            <a href="login.html" class="px-4 py-2 text-dark hover:text-primary font-medium transition-custom">登录</a>
                            <a href="register.html" class="px-6 py-2 bg-primary text-white font-medium rounded-full shadow-soft hover:shadow-hover transition-custom hover:-translate-y-0.5">开始创作</a>
                        </div>
                    </div>
                    
                    <!-- 移动端菜单按钮 -->
                    <button id="menu-toggle" class="md:hidden text-dark hover:text-primary text-xl focus:outline-none">
                        <i class="fa fa-bars"></i>
                    </button>
                </div>
            </nav>
        </div>
        
        <!-- 移动端导航菜单 -->
        <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg absolute w-full">
            <div class="container mx-auto px-4 py-4 space-y-3">
                <a href="index.html" class="block py-2 text-dark hover:text-primary font-medium transition-custom">首页</a>
                <a href="works.html" class="block py-2 text-dark hover:text-primary font-medium transition-custom">我的作品</a>
                <a href="generator.html" class="block py-2 text-primary font-medium transition-custom">AI生成器</a>
                <a href="community.html" class="block py-2 text-dark hover:text-primary font-medium transition-custom">社区</a>
                <a href="profile.html" class="block py-2 text-dark hover:text-primary font-medium transition-custom">个人中心</a>
                <a href="login.html" class="block py-2 text-dark hover:text-primary font-medium transition-custom">登录</a>
            </div>
        </div>
    </header>

    <!-- 主要内容 -->
    <div class="pt-28 md:pt-32 pb-16">
        <div class="container mx-auto px-4 md:px-6">
            <!-- 页面标题 -->
            <div class="text-center max-w-3xl mx-auto mb-12">
                <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-serif font-bold text-dark mb-4">AI 文创生成器</h1>
                <p class="text-muted text-lg">基于深度学习算法，快速生成独特的文创设计，支持风格定制和参数调整</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- 左侧控制面板 -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-soft p-6 sticky top-32">
                        <h2 class="text-xl font-serif font-bold text-dark mb-6">生成设置</h2>
                        
                        <form id="generator-form" class="space-y-6">
                            <!-- 风格选择 -->
                            <div>
                                <label class="block text-sm font-medium text-dark mb-3">风格选择</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="style" value="traditional" class="sr-only" checked>
                                        <div class="border-2 border-gray-200 rounded-lg p-3 text-center hover:border-primary transition-custom">
                                            <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center text-primary mx-auto mb-2">
                                                <i class="fa fa-pagoda"></i>
                                            </div>
                                            <span class="text-sm font-medium">传统纹样</span>
                                        </div>
                                        <div class="absolute top-2 right-2 w-4 h-4 border-2 border-gray-300 rounded-full">
                                            <div class="w-2 h-2 bg-primary rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-0"></div>
                                        </div>
                                    </label>
                                    
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="style" value="modern" class="sr-only">
                                        <div class="border-2 border-gray-200 rounded-lg p-3 text-center hover:border-primary transition-custom">
                                            <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center text-primary mx-auto mb-2">
                                                <i class="fa fa-diamond"></i>
                                            </div>
                                            <span class="text-sm font-medium">国潮风格</span>
                                        </div>
                                        <div class="absolute top-2 right-2 w-4 h-4 border-2 border-gray-300 rounded-full">
                                            <div class="w-2 h-2 bg-primary rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-0"></div>
                                        </div>
                                    </label>
                                    
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="style" value="ink" class="sr-only">
                                        <div class="border-2 border-gray-200 rounded-lg p-3 text-center hover:border-primary transition-custom">
                                            <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center text-primary mx-auto mb-2">
                                                <i class="fa fa-tint"></i>
                                            </div>
                                            <span class="text-sm font-medium">水墨风格</span>
                                        </div>
                                        <div class="absolute top-2 right-2 w-4 h-4 border-2 border-gray-300 rounded-full">
                                            <div class="w-2 h-2 bg-primary rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-0"></div>
                                        </div>
                                    </label>
                                    
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="style" value="minimal" class="sr-only">
                                        <div class="border-2 border-gray-200 rounded-lg p-3 text-center hover:border-primary transition-custom">
                                            <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center text-primary mx-auto mb-2">
                                                <i class="fa fa-cube"></i>
                                            </div>
                                            <span class="text-sm font-medium">极简主义</span>
                                        </div>
                                        <div class="absolute top-2 right-2 w-4 h-4 border-2 border-gray-300 rounded-full">
                                            <div class="w-2 h-2 bg-primary rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-0"></div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- 复杂度调节 -->
                            <div>
                                <label class="block text-sm font-medium text-dark mb-3">
                                    复杂度
                                    <span id="complexity-value" class="text-primary font-medium">5</span>
                                </label>
                                <input type="range" id="complexity" min="1" max="10" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                                <div class="flex justify-between text-xs text-muted mt-1">
                                    <span>简单</span>
                                    <span>复杂</span>
                                </div>
                            </div>
                            
                            <!-- 色彩方案 -->
                            <div>
                                <label class="block text-sm font-medium text-dark mb-3">色彩方案</label>
                                <div class="grid grid-cols-5 gap-2">
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="color" value="warm" class="sr-only" checked>
                                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-red-500 to-yellow-500 border-2 border-white shadow-sm"></div>
                                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-primary rounded-full opacity-0"></div>
                                    </label>
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="color" value="cool" class="sr-only">
                                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 border-2 border-white shadow-sm"></div>
                                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-primary rounded-full opacity-0"></div>
                                    </label>
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="color" value="earth" class="sr-only">
                                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-brown-500 to-orange-500 border-2 border-white shadow-sm"></div>
                                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-primary rounded-full opacity-0"></div>
                                    </label>
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="color" value="pastel" class="sr-only">
                                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-pink-300 to-blue-300 border-2 border-white shadow-sm"></div>
                                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-primary rounded-full opacity-0"></div>
                                    </label>
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="color" value="mono" class="sr-only">
                                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-gray-400 to-gray-600 border-2 border-white shadow-sm"></div>
                                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-primary rounded-full opacity-0"></div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- 关键词输入 -->
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">关键词描述</label>
                                <textarea 
                                    id="keywords"
                                    class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary transition-custom resize-none"
                                    rows="3"
                                    placeholder="描述你想要的文创设计，例如：龙纹、祥云、传统吉祥图案..."
                                ></textarea>
                            </div>
                            
                            <!-- 生成按钮 -->
                            <button 
                                type="submit"
                                id="generate-btn"
                                class="w-full py-4 bg-primary text-white font-medium rounded-lg shadow-soft hover:shadow-hover transition-custom hover:-translate-y-0.5 flex items-center justify-center"
                            >
                                <i class="fa fa-magic mr-2"></i>
                                <span>生成纹样</span>
                            </button>
                            
                            <!-- 剩余生成次数 -->
                            <div class="text-center">
                                <p class="text-sm text-muted">
                                    剩余生成次数: 
                                    <span id="remaining-count" class="text-primary font-medium">5</span>
                                </p>
                                <p class="text-xs text-muted mt-1">免费用户每月5次生成额度</p>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- 右侧预览区域 -->
                <div class="lg:col-span-2">
                    <!-- 预览区域 -->
                    <div class="bg-white rounded-2xl shadow-soft p-8 mb-8">
                        <h2 class="text-xl font-serif font-bold text-dark mb-6">预览区域</h2>
                        
                        <div class="bg-gray-50 rounded-xl p-8 min-h-[400px] flex items-center justify-center">
                            <div id="preview-area" class="text-center">
                                <div class="w-24 h-24 bg-primary/10 rounded-full flex items-center justify-center text-primary text-3xl mx-auto mb-4">
                                    <i class="fa fa-image"></i>
                                </div>
                                <p class="text-muted mb-4">调整左侧参数后点击生成按钮</p>
                                <p class="text-sm text-muted">生成时间约15-30秒</p>
                            </div>
                            
                            <div id="generated-image" class="hidden">
                                <img id="result-image" src="" alt="生成的纹样" class="max-w-full max-h-96 mx-auto rounded-lg shadow-sm">
                                <div class="mt-4 text-center">
                                    <p class="text-sm text-muted mb-2">生成时间: <span id="generation-time">15</span>秒</p>
                                    <div class="flex justify-center space-x-3">
                                        <button id="download-btn" class="px-4 py-2 bg-primary text-white text-sm rounded-lg hover:bg-primary/90 transition-custom">
                                            <i class="fa fa-download mr-1"></i>下载
                                        </button>
                                        <button id="regenerate-btn" class="px-4 py-2 border border-primary text-primary text-sm rounded-lg hover:bg-primary/5 transition-custom">
                                            <i class="fa fa-refresh mr-1"></i>重新生成
                                        </button>
                                        <button id="save-btn" class="px-4 py-2 border border-gray-300 text-gray-600 text-sm rounded-lg hover:bg-gray-50 transition-custom">
                                            <i class="fa fa-save mr-1"></i>保存作品
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 加载状态 -->
                            <div id="loading-state" class="hidden text-center">
                                <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                                <p class="text-muted">AI正在生成纹样...</p>
                                <p class="text-sm text-muted mt-1">请耐心等待，这可能需要一些时间</p>
                            </div>
                        </div>
                    </div>

                    <!-- 历史记录 -->
                    <div class="bg-white rounded-2xl shadow-soft p-8">
                        <h2 class="text-xl font-serif font-bold text-dark mb-6">最近生成</h2>
                        
                        <div id="history-list" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <!-- 历史记录项 -->
                            <div class="border border-gray-200 rounded-lg p-3 hover:border-primary transition-custom cursor-pointer">
                                <img src="https://picsum.photos/seed/123/200/200" alt="历史纹样" class="w-full h-24 object-cover rounded mb-2">
                                <p class="text-xs text-muted truncate">传统龙纹</p>
                                <p class="text-xs text-gray-500">2小时前</p>
                            </div>
                            
                            <div class="border border-gray-200 rounded-lg p-3 hover:border-primary transition-custom cursor-pointer">
                                <img src="https://picsum.photos/seed/456/200/200" alt="历史纹样" class="w-full h-24 object-cover rounded mb-2">
                                <p class="text-xs text-muted truncate">祥云图案</p>
                                <p class="text-xs text-gray-500">1天前</p>
                            </div>
                            
                            <div class="border border-gray-200 rounded-lg p-3 hover:border-primary transition-custom cursor-pointer">
                                <img src="https://picsum.photos/seed/789/200/200" alt="历史纹样" class="w-full h-24 object-cover rounded mb-2">
                                <p class="text-xs text-muted truncate">国潮纹样</p>
                                <p class="text-xs text-gray-500">3天前</p>
                            </div>
                        </div>
                        
                        <div class="text-center mt-6">
                            <a href="works.html" class="text-primary text-sm font-medium hover:underline">
                                查看全部作品 <i class="fa fa-long-arrow-right ml-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-dark text-white pt-16 pb-8">
        <div class="container mx-auto px-4 md:px-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8 mb-12">
                <!-- 品牌信息 -->
                <div class="lg:col-span-2">
                    <div class="flex items-center mb-6">
                        <img src="logo.jpg" alt="Lingo Logo" class="h-16">
                    </div>
                    <p class="text-gray-400 mb-6 max-w-xs">
                        Lingo 致力于通过人工智能技术赋能文化创意产业，让传统与创新完美融合，激发无限可能。
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center text-white hover:bg-primary transition-custom">
                            <i class="fa fa-weibo"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center text-white hover:bg-primary transition-custom">
                            <i class="fa fa-wechat"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center text-white hover:bg-primary transition-custom">
                            <i class="fa fa-instagram"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center text-white hover:bg-primary transition-custom">
                            <i class="fa fa-behance"></i>
                        </a>
                    </div>
                </div>
                
                <!-- 快速链接 -->
                <div>
                    <h4 class="text-lg font-bold mb-4">快速链接</h4>
                    <ul class="space-y-2">
                        <li><a href="index.html" class="text-gray-400 hover:text-primary transition-custom">首页</a></li>
                        <li><a href="works.html" class="text-gray-400 hover:text-primary transition-custom">我的作品</a></li>
                        <li><a href="generator.html" class="text-gray-400 hover:text-primary transition-custom">AI生成器</a></li>
                        <li><a href="community.html" class="text-gray-400 hover:text-primary transition-custom">社区</a></li>
                        <li><a href="profile.html" class="text-gray-400 hover:text-primary transition-custom">个人中心</a></li>
                    </ul>
                </div>
                
                <!-- 资源 -->
                <div>
                    <h4 class="text-lg font-bold mb-4">资源中心</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-custom">帮助文档</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-custom">教程视频</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-custom">设计指南</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-custom">API 文档</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary transition-custom">版权保护</a></li>
                    </ul>
                </div>
                
                <!-- 联系我们 -->
                <div>
                    <h4 class="text-lg font-bold mb-4">联系我们</h4>
                    <ul class="space-y-2">
                        <li class="flex items-start">
                            <i class="fa fa-envelope text-primary mr-2 mt-1"></i>
                            <span class="text-gray-400">contact@lingo.com</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-phone text-primary mr-2 mt-1"></i>
                            <span class="text-gray-400">400-123-4567</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-map-marker text-primary mr-2 mt-1"></i>
                            <span class="text-gray-400">北京市海淀区中关村创意产业园 A 座 1001</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- 版权信息 -->
            <div class="border-t border-white/10 pt-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <p class="text-gray-400 text-sm mb-4 md:mb-0">© 2023 Lingo 智能文创平台. 保留所有权利.</p>
                    <div class="flex space-x-6">
                        <a href="#" class="text-gray-400 text-sm hover:text-primary transition-custom">隐私政策</a>
                        <a href="#" class="text-gray-400 text-sm hover:text-primary transition-custom">服务条款</a>
                        <a href="#" class="text-gray-400 text-sm hover:text-primary transition-custom">Cookie 政策</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- 脚本 -->
    <script>
        // 导航栏滚动效果
        const navbar = document.getElementById('navbar');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                navbar.classList.add('bg-white', 'shadow-soft', 'blur-backdrop');
                navbar.classList.remove('bg-transparent');
            } else {
                navbar.classList.remove('bg-white', 'shadow-soft', 'blur-backdrop');
                navbar.classList.add('bg-transparent');
            }
        });
        
        // 移动端菜单切换
        const menuToggle = document.getElementById('menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        menuToggle.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
        
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                    
                    // 关闭移动端菜单
                    if (!mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                }
            });
        });

        // API基础URL
        const API_BASE_URL = 'http://localhost:3000/api';

        // 用户状态管理
        function updateUserStatus() {
            const token = localStorage.getItem('lingo_token');
            const userData = localStorage.getItem('lingo_user');
            
            const loggedInUser = document.getElementById('logged-in-user');
            const guestUser = document.getElementById('guest-user');
            const userStatus = document.getElementById('user-status');
            
            if (token && userData) {
                try {
                    const user = JSON.parse(userData);
                    
                    // 显示用户信息
                    document.getElementById('user-name').textContent = user.username;
                    document.getElementById('user-avatar').src = user.avatar || 'https://randomuser.me/api/portraits/lego/1.jpg';
                    
                    // 切换显示状态
                    loggedInUser.classList.remove('hidden');
                    guestUser.classList.add('hidden');
                    userStatus.classList.remove('hidden');
                } catch (error) {
                    console.error('解析用户数据失败:', error);
                    clearUserData();
                }
            } else {
                // 显示访客状态
                loggedInUser.classList.add('hidden');
                guestUser.classList.remove('hidden');
                userStatus.classList.remove('hidden');
            }
        }

        // 退出登录
        function logout() {
            clearUserData();
            updateUserStatus();
            alert('已退出登录');
        }

        // 清除用户数据
        function clearUserData() {
            localStorage.removeItem('lingo_token');
            localStorage.removeItem('lingo_user');
            localStorage.removeItem('lingo_remember');
        }

        // 检查用户登录状态
        async function checkUserAuth() {
            const token = localStorage.getItem('lingo_token');
            if (!token) {
                return false;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/auth/me`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // 更新用户信息
                    localStorage.setItem('lingo_user', JSON.stringify(result.data.user));
                    return true;
                } else {
                    // token无效，清除数据
                    clearUserData();
                    return false;
                }
            } catch (error) {
                console.error('验证用户状态失败:', error);
                return false;
            }
        }

        // 页面加载时初始化用户状态
        document.addEventListener('DOMContentLoaded', async () => {
            // 先更新UI状态
            updateUserStatus();
            
            // 然后验证token有效性
            const isValid = await checkUserAuth();
            if (!isValid) {
                updateUserStatus(); // 重新更新状态
            }
            
            // 绑定退出按钮事件
            document.getElementById('logout-btn').addEventListener('click', logout);
        });

        // AI生成器功能
        document.addEventListener('DOMContentLoaded', function() {
            // 复杂度滑块
            const complexitySlider = document.getElementById('complexity');
            const complexityValue = document.getElementById('complexity-value');
            
            complexitySlider.addEventListener('input', function() {
                complexityValue.textContent = this.value;
            });
            
            // 风格选择样式
            document.querySelectorAll('input[name="style"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.querySelectorAll('input[name="style"]').forEach(r => {
                        const parent = r.closest('label');
                        const indicator = parent.querySelector('.absolute > div');
                        if (r.checked) {
                            parent.querySelector('div').classList.add('border-primary', 'bg-primary/5');
                            indicator.classList.remove('opacity-0');
                        } else {
                            parent.querySelector('div').classList.remove('border-primary', 'bg-primary/5');
                            indicator.classList.add('opacity-0');
                        }
                    });
                });
            });
            
            // 色彩方案选择样式
            document.querySelectorAll('input[name="color"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.querySelectorAll('input[name="color"]').forEach(r => {
                        const indicator = r.nextElementSibling.nextElementSibling;
                        if (r.checked) {
                            indicator.classList.remove('opacity-0');
                        } else {
                            indicator.classList.add('opacity-0');
                        }
                    });
                });
            });
            
            // 初始化样式
            document.querySelector('input[name="style"]:checked').dispatchEvent(new Event('change'));
            document.querySelector('input[name="color"]:checked').dispatchEvent(new Event('change'));
            
            // 生成表单提交
            document.getElementById('generator-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const token = localStorage.getItem('lingo_token');
                if (!token) {
                    alert('请先登录后再使用AI生成功能');
                    window.location.href = 'login.html';
                    return;
                }
                
                const remainingCount = parseInt(document.getElementById('remaining-count').textContent);
                if (remainingCount <= 0) {
                    alert('本月生成次数已用完，请升级会员或等待下个月');
                    return;
                }
                
                const style = document.querySelector('input[name="style"]:checked').value;
                const complexity = document.getElementById('complexity').value;
                const color = document.querySelector('input[name="color"]:checked').value;
                const keywords = document.getElementById('keywords').value.trim();
                
                if (!keywords) {
                    alert('请输入关键词描述');
                    return;
                }
                
                // 显示加载状态
                const generateBtn = document.getElementById('generate-btn');
                const originalText = generateBtn.innerHTML;
                generateBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>生成中...';
                generateBtn.disabled = true;
                
                document.getElementById('preview-area').classList.add('hidden');
                document.getElementById('generated-image').classList.add('hidden');
                document.getElementById('loading-state').classList.remove('hidden');
                
                try {
                    // 模拟API调用
                    setTimeout(() => {
                        // 模拟生成结果
                        document.getElementById('loading-state').classList.add('hidden');
                        document.getElementById('generated-image').classList.remove('hidden');
                        
                        // 使用随机图片作为生成结果
                        const randomSeed = Math.floor(Math.random() * 1000);
                        document.getElementById('result-image').src = `https://picsum.photos/seed/${randomSeed}/600/600`;
                        document.getElementById('generation-time').textContent = Math.floor(Math.random() * 10) + 15;
                        
                        // 更新剩余次数
                        document.getElementById('remaining-count').textContent = remainingCount - 1;
                        
                        // 恢复按钮状态
                        generateBtn.innerHTML = originalText;
                        generateBtn.disabled = false;
                    }, 3000);
                    
                } catch (error) {
                    console.error('生成失败:', error);
                    alert('生成失败，请稍后重试');
                    
                    // 恢复按钮状态
                    generateBtn.innerHTML = originalText;
                    generateBtn.disabled = false;
                    document.getElementById('loading-state').classList.add('hidden');
                    document.getElementById('preview-area').classList.remove('hidden');
                }
            });
            
            // 下载按钮
            document.getElementById('download-btn').addEventListener('click', function() {
                const imageUrl = document.getElementById('result-image').src;
                const link = document.createElement('a');
                link.href = imageUrl;
                link.download = 'lingo-generated-pattern.png';
                link.click();
            });
            
            // 重新生成按钮
            document.getElementById('regenerate-btn').addEventListener('click', function() {
                document.getElementById('generator-form').dispatchEvent(new Event('submit'));
            });
            
            // 保存作品按钮
            document.getElementById('save-btn').addEventListener('click', function() {
                const token = localStorage.getItem('lingo_token');
                if (!token) {
                    alert('请先登录后再保存作品');
                    return;
                }
                
                const imageUrl = document.getElementById('result-image').src;
                const keywords = document.getElementById('keywords').value.trim();
                
                // 这里应该是实际的保存作品API调用
                alert('作品已保存到"我的作品"页面');
            });
            
            // 历史记录点击事件
            document.querySelectorAll('#history-list > div').forEach(item => {
                item.addEventListener('click', function() {
                    const img = this.querySelector('img');
                    document.getElementById('preview-area').classList.add('hidden');
                    document.getElementById('generated-image').classList.remove('hidden');
                    document.getElementById('result-image').src = img.src;
                });
            });
        });
    </script>
</body>
</html>
